<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication - Conference Party</title>
</head>
<body>
    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
        <div style="text-align: center;">
            <div style="margin-bottom: 20px;">
                <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
            </div>
            <h2>Completing authentication...</h2>
            <p style="color: #666;">Please wait while we complete your LinkedIn sign-in.</p>
        </div>
    </div>

    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <script>
        // LinkedIn OAuth callback handler
        (function() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get('code');
                const state = urlParams.get('state');
                const error = urlParams.get('error');
                const errorDescription = urlParams.get('error_description');

                if (error) {
                    // Auth error occurred
                    window.opener?.postMessage({
                        type: 'auth-error',
                        error: errorDescription || error
                    }, window.location.origin);
                    window.close();
                    return;
                }

                if (!code || !state) {
                    // Missing required parameters
                    window.opener?.postMessage({
                        type: 'auth-error',
                        error: 'Invalid authentication response'
                    }, window.location.origin);
                    window.close();
                    return;
                }

                // Exchange code for user data (simplified for demo)
                // In production, this would make API calls to LinkedIn
                const mockUserData = {
                    id: 'linkedin-' + Date.now(),
                    name: 'Professional User',
                    email: 'user@company.com',
                    picture: 'https://via.placeholder.com/100x100?text=User',
                    provider: 'linkedin',
                    accessToken: code // In production, exchange for real access token
                };

                // Send success message to parent window
                window.opener?.postMessage({
                    type: 'auth-success',
                    user: mockUserData
                }, window.location.origin);

                // Close popup
                window.close();

            } catch (error) {
                console.error('Auth callback error:', error);
                window.opener?.postMessage({
                    type: 'auth-error',
                    error: 'Authentication processing failed'
                }, window.location.origin);
                window.close();
            }
        })();
    </script>
</body>
</html>