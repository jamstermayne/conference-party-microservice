<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Add to Calendar Test</title>
  <link rel="stylesheet" href="/assets/css/calendar-modal.css">
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .event-card {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      background: #fafafa;
    }
    .event-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 10px;
      color: #1f2937;
    }
    .event-details {
      color: #6b7280;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    .event-meta {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
      font-size: 14px;
      color: #4b5563;
    }
    .add-btn {
      background: #4f46e5;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    .add-btn:hover {
      background: #4338ca;
    }
    .status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 6px;
      background: #f0f9ff;
      color: #0369a1;
      font-size: 14px;
    }
    .status.connected {
      background: #f0fdf4;
      color: #166534;
    }
    .disconnect-btn {
      background: #ef4444;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      margin-left: 10px;
    }
    .disconnect-btn:hover {
      background: #dc2626;
    }
    pre {
      background: #1f2937;
      color: #f3f4f6;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 12px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üóìÔ∏è Smart Add to Calendar</h1>
    <p class="subtitle">Test the intelligent calendar integration flow</p>
    
    <div id="connection-status" class="status">
      Checking Google Calendar connection...
    </div>
    
    <div class="event-card">
      <div class="event-title">Gamescom Opening Night Live</div>
      <div class="event-details">
        Join us for the biggest gaming event of the year! Experience exclusive game reveals, world premieres, and special announcements.
      </div>
      <div class="event-meta">
        <span>üìÖ August 20, 2025 - 8:00 PM</span>
        <span>üìç Koelnmesse, Cologne</span>
        <span>‚è±Ô∏è 2 hours</span>
      </div>
      <button class="add-btn" onclick="addEvent1()">Add to Calendar</button>
    </div>
    
    <div class="event-card">
      <div class="event-title">Indie Games Showcase</div>
      <div class="event-details">
        Discover the most innovative indie games of 2025. Meet the developers and try exclusive demos.
      </div>
      <div class="event-meta">
        <span>üìÖ August 21, 2025 - 2:00 PM</span>
        <span>üìç Hall 10.2</span>
        <span>‚è±Ô∏è 3 hours</span>
      </div>
      <button class="add-btn" onclick="addEvent2()">Add to Calendar</button>
    </div>
    
    <div class="event-card">
      <div class="event-title">Developer Networking Mixer</div>
      <div class="event-details">
        Connect with game developers from around the world. Casual networking with drinks and snacks provided.
      </div>
      <div class="event-meta">
        <span>üìÖ August 22, 2025 - 6:00 PM</span>
        <span>üìç Hyatt Regency Cologne</span>
        <span>‚è±Ô∏è 2 hours</span>
      </div>
      <button class="add-btn" onclick="addEvent3()">Add to Calendar</button>
    </div>
    
    <pre id="log">Event Log:
</pre>
  </div>

  <script type="module">
    import { handleAddToCalendar } from './js/ui/add-to-calendar.js';
    import { GCal } from './js/services/gcal.js';
    
    const log = document.getElementById('log');
    const statusEl = document.getElementById('connection-status');
    
    function addLog(message) {
      const timestamp = new Date().toLocaleTimeString();
      log.textContent += `[${timestamp}] ${message}\n`;
    }
    
    // Check initial connection status
    async function checkStatus() {
      try {
        const connected = await GCal.isConnected();
        if (connected) {
          statusEl.className = 'status connected';
          statusEl.innerHTML = '‚úÖ Google Calendar is connected <button class="disconnect-btn" id="disconnect">Disconnect</button>';
          document.getElementById('disconnect')?.addEventListener('click', disconnect);
        } else {
          statusEl.className = 'status';
          statusEl.innerHTML = 'üìå Google Calendar not connected (you\'ll be prompted when adding events)';
        }
      } catch (error) {
        statusEl.className = 'status';
        statusEl.innerHTML = '‚ö†Ô∏è Could not check connection status';
      }
    }
    
    async function disconnect() {
      try {
        await GCal.disconnect();
        addLog('Disconnected from Google Calendar');
        checkStatus();
      } catch (error) {
        addLog('Failed to disconnect: ' + error.message);
      }
    }
    
    // Sample events
    const events = {
      event1: {
        title: 'Gamescom Opening Night Live',
        description: 'Join us for the biggest gaming event of the year! Experience exclusive game reveals, world premieres, and special announcements.',
        location: 'Koelnmesse, Cologne',
        start: new Date('2025-08-20T20:00:00').toISOString(),
        end: new Date('2025-08-20T22:00:00').toISOString(),
        slug: 'gamescom-opening'
      },
      event2: {
        title: 'Indie Games Showcase',
        description: 'Discover the most innovative indie games of 2025. Meet the developers and try exclusive demos.',
        location: 'Hall 10.2',
        start: new Date('2025-08-21T14:00:00').toISOString(),
        end: new Date('2025-08-21T17:00:00').toISOString(),
        slug: 'indie-showcase'
      },
      event3: {
        title: 'Developer Networking Mixer',
        description: 'Connect with game developers from around the world. Casual networking with drinks and snacks provided.',
        location: 'Hyatt Regency Cologne',
        start: new Date('2025-08-22T18:00:00').toISOString(),
        end: new Date('2025-08-22T20:00:00').toISOString(),
        slug: 'dev-mixer'
      }
    };
    
    // Make functions globally available
    window.addEvent1 = () => {
      addLog('Adding: ' + events.event1.title);
      handleAddToCalendar(events.event1, {
        onSuccess: (provider, result) => {
          addLog(`‚úÖ Successfully added to ${provider}`);
          if (result?.htmlLink) {
            addLog(`View in calendar: ${result.htmlLink}`);
          }
          checkStatus();
        },
        onError: (error) => {
          addLog(`‚ùå Error: ${error.message}`);
        }
      });
    };
    
    window.addEvent2 = () => {
      addLog('Adding: ' + events.event2.title);
      handleAddToCalendar(events.event2, {
        onSuccess: (provider, result) => {
          addLog(`‚úÖ Successfully added to ${provider}`);
          if (result?.htmlLink) {
            addLog(`View in calendar: ${result.htmlLink}`);
          }
          checkStatus();
        },
        onError: (error) => {
          addLog(`‚ùå Error: ${error.message}`);
        }
      });
    };
    
    window.addEvent3 = () => {
      addLog('Adding: ' + events.event3.title);
      handleAddToCalendar(events.event3, {
        onSuccess: (provider, result) => {
          addLog(`‚úÖ Successfully added to ${provider}`);
          if (result?.htmlLink) {
            addLog(`View in calendar: ${result.htmlLink}`);
          }
          checkStatus();
        },
        onError: (error) => {
          addLog(`‚ùå Error: ${error.message}`);
        }
      });
    };
    
    // Initialize
    checkStatus();
    addLog('Page loaded - Smart calendar integration ready');
  </script>
</body>
</html>