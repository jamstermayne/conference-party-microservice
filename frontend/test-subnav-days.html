<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subnav Days Test</title>
  <link rel="stylesheet" href="/assets/css/spacing-tokens.css">
  <link rel="stylesheet" href="/assets/css/color-tokens.css">
  <link rel="stylesheet" href="/assets/css/sidebar-modern.css">
  <style>
    body {
      margin: 0;
      padding: 0;
      background: var(--nav-bg, #0E121A);
      color: var(--nav-text, #CFE0FF);
      font-family: system-ui, -apple-system, sans-serif;
      display: grid;
      grid-template-columns: auto 1fr;
    }
    
    #main {
      padding: var(--s-6);
    }
    
    .test-section {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: var(--r-lg);
      padding: var(--s-4);
      margin-bottom: var(--s-4);
    }
    
    .test-section h2 {
      margin-top: 0;
      color: var(--nav-accent-2);
    }
    
    .status-grid {
      display: grid;
      gap: var(--s-2);
      font-family: monospace;
      font-size: 0.875rem;
    }
    
    .status-item {
      display: grid;
      grid-template-columns: 150px 1fr;
      gap: var(--s-3);
      padding: var(--s-2);
      background: rgba(0,0,0,0.3);
      border-radius: var(--r-md);
    }
    
    .status-label {
      color: var(--nav-text-dim);
    }
    
    .status-value {
      color: var(--nav-accent-2);
    }
    
    .test-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: var(--s-2);
    }
    
    .test-btn {
      padding: var(--s-2) var(--s-3);
      background: rgba(110,94,246,0.1);
      border: 1px solid rgba(110,94,246,0.3);
      color: var(--nav-text);
      border-radius: var(--r-md);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .test-btn:hover {
      background: rgba(110,94,246,0.2);
      border-color: rgba(110,94,246,0.5);
    }
    
    .days-display {
      display: flex;
      flex-wrap: wrap;
      gap: var(--s-2);
      margin-top: var(--s-3);
    }
    
    .day-pill {
      padding: var(--s-1) var(--s-2);
      background: rgba(110,94,246,0.1);
      border: 1px solid rgba(110,94,246,0.2);
      border-radius: var(--r-full);
      font-size: 0.875rem;
    }
  </style>
</head>
<body>
  <aside id="sidebar" class="v-sidebar">
    <a class="v-brand" href="#/parties">velocity.ai</a>

    <nav class="v-nav" aria-label="Primary">
      <a class="v-nav__link" data-route="parties" href="#/parties">
        <span class="v-nav__icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 7h18"/><path d="M3 12h18"/><path d="M3 17h18"/>
          </svg>
        </span>
        <span class="v-nav__label">parties</span>
      </a>
      
      <!-- Subnav placeholder for parties days -->
      <div class="v-subnav" data-subnav="parties" aria-label="Parties days"></div>

      <a class="v-nav__link" data-route="calendar" href="#/calendar">
        <span class="v-nav__icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="3"/><path d="M16 2v4M8 2v4M3 10h18"/>
          </svg>
        </span>
        <span class="v-nav__label">calendar</span>
      </a>

      <a class="v-nav__link" data-route="map" href="#/map">
        <span class="v-nav__icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6l7-3 7 3 4-2v14l-7 3-7-3-4 2V4z"/>
          </svg>
        </span>
        <span class="v-nav__label">map</span>
      </a>
      
      <!-- Subnav placeholder for map days -->
      <div class="v-subnav" data-subnav="map" aria-label="Map days"></div>

      <a class="v-nav__link" data-route="invites" href="#/invites">
        <span class="v-nav__icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 12l-10 7L2 12l10-7 10 7z"/><path d="M2 12l10 7 10-7"/>
          </svg>
        </span>
        <span class="v-nav__label">invites</span>
      </a>
    </nav>
  </aside>

  <main id="main">
    <h1>Subnav Days Test</h1>
    
    <div class="test-section">
      <h2>Navigation Controls</h2>
      <div class="test-buttons">
        <button class="test-btn" onclick="location.hash='#/parties'">Go to Parties</button>
        <button class="test-btn" onclick="location.hash='#/map'">Go to Map</button>
        <button class="test-btn" onclick="location.hash='#/calendar'">Go to Calendar</button>
        <button class="test-btn" onclick="location.hash='#/map/2025-08-18'">Map Monday</button>
        <button class="test-btn" onclick="location.hash='#/parties/2025-08-22'">Parties Friday</button>
      </div>
    </div>

    <div class="test-section">
      <h2>Current Status</h2>
      <div class="status-grid">
        <div class="status-item">
          <span class="status-label">Current Hash:</span>
          <span class="status-value" id="current-hash">#/parties</span>
        </div>
        <div class="status-item">
          <span class="status-label">Subnav Visible:</span>
          <span class="status-value" id="subnav-visible">No</span>
        </div>
        <div class="status-item">
          <span class="status-label">Active Subnav:</span>
          <span class="status-value" id="active-subnav">None</span>
        </div>
        <div class="status-item">
          <span class="status-label">Days Loaded:</span>
          <span class="status-value" id="days-count">0</span>
        </div>
      </div>
    </div>

    <div class="test-section">
      <h2>Fetched Days</h2>
      <p>Days extracted from API (Mon-Sat only):</p>
      <div class="days-display" id="days-display"></div>
    </div>

    <div class="test-section">
      <h2>API Response</h2>
      <pre id="api-response" style="background: rgba(0,0,0,0.5); padding: var(--s-3); border-radius: var(--r-md); overflow-x: auto; font-size: 0.75rem;">Fetching...</pre>
    </div>
  </main>

  <script src="/js/sidebar-map-subnav.js"></script>
  <script>
    // Monitor and display status
    function updateStatus() {
      const hash = location.hash || '#/parties';
      const sidebar = document.querySelector('.v-sidebar');
      const hasSubnav = sidebar?.classList.contains('v-show-subnav');
      
      document.getElementById('current-hash').textContent = hash;
      document.getElementById('subnav-visible').textContent = hasSubnav ? 'Yes' : 'No';
      
      // Check which subnav has links
      const mapLinks = document.querySelectorAll('.v-subnav[data-subnav="map"] .v-subnav__link');
      const partiesLinks = document.querySelectorAll('.v-subnav[data-subnav="parties"] .v-subnav__link');
      
      let activeSubnav = 'None';
      if (hash.startsWith('#/map') && mapLinks.length > 0) activeSubnav = 'Map';
      else if ((hash.startsWith('#/parties') || hash === '#' || hash === '') && partiesLinks.length > 0) activeSubnav = 'Parties';
      
      document.getElementById('active-subnav').textContent = activeSubnav;
      document.getElementById('days-count').textContent = Math.max(mapLinks.length, partiesLinks.length);
    }
    
    // Display fetched days
    async function displayDays() {
      try {
        const r = await fetch('/api/parties?conference=gamescom2025');
        const json = await r.json();
        document.getElementById('api-response').textContent = JSON.stringify(json, null, 2);
        
        const rows = json.data || json.parties || json || [];
        const dates = new Set();
        
        for (const e of rows) {
          const dateStr = e.start || e.startsAt || e.date;
          if (dateStr) {
            const d = new Date(dateStr);
            if (!isNaN(d)) {
              const iso = d.toISOString().slice(0, 10);
              const day = d.getDay();
              if (day >= 1 && day <= 6) { // Mon-Sat only
                dates.add(iso);
              }
            }
          }
        }
        
        const display = document.getElementById('days-display');
        display.innerHTML = '';
        Array.from(dates).sort().forEach(iso => {
          const pill = document.createElement('div');
          pill.className = 'day-pill';
          const d = new Date(iso + 'T00:00:00');
          const day = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][d.getDay()];
          pill.textContent = `${day} ${iso}`;
          display.appendChild(pill);
        });
      } catch (err) {
        document.getElementById('api-response').textContent = `Error: ${err.message}`;
      }
    }
    
    // Initialize monitoring
    window.addEventListener('hashchange', updateStatus);
    document.addEventListener('DOMContentLoaded', () => {
      updateStatus();
      displayDays();
    });
    
    // Update every second to catch dynamic changes
    setInterval(updateStatus, 1000);
  </script>
</body>
</html>