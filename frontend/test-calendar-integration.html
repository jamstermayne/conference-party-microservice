<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calendar Integration Test</title>
  <link rel="stylesheet" href="/assets/css/spacing-tokens.css">
  <link rel="stylesheet" href="/assets/css/color-tokens.css">
  <link rel="stylesheet" href="/assets/css/hero-cards.css">
  <style>
    body { 
      padding: var(--s-4); 
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: system-ui, -apple-system, sans-serif;
    }
    .container { max-width: 800px; margin: 0 auto; }
    .status { 
      padding: var(--s-3); 
      background: var(--bg-secondary); 
      border-radius: var(--r-2);
      margin-bottom: var(--s-4);
    }
    .vgrid { 
      display: grid; 
      gap: var(--s-3); 
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    }
    .btn-success { 
      background: var(--color-success, #22c55e) !important;
      color: white !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Calendar Integration Test</h1>
    
    <div class="status" id="status">
      <p>Checking Google Calendar connection...</p>
    </div>

    <h2>Test Events</h2>
    <div class="vgrid">
      <article class="vcard" data-party-id="test-1" 
               data-start-iso="2025-08-22T09:00:00Z" 
               data-end-iso="2025-08-22T18:00:00Z">
        <header class="vcard__head">
          <h3 class="vcard__title">MeetToMatch Cologne 2025</h3>
          <div class="vcard__badges">
            <span class="badge">From £127</span>
            <span class="badge badge-live">live</span>
          </div>
        </header>
        
        <div class="vcard__meta">
          <span class="meta"><i class="i-clock"></i>09:00 – 18:00</span>
          <button class="link pin">
            <i class="i-pin"></i> Kölnmesse Confex
          </button>
        </div>
        
        <div class="vcard__body">
          <p class="vcard__desc">The premier B2B matchmaking event for the games industry at Gamescom 2025.</p>
        </div>
        
        <footer class="vcard__foot">
          <button class="btn btn-primary" 
                  data-action="add-to-calendar" 
                  data-id="test-1"
                  data-start-iso="2025-08-22T09:00:00Z"
                  data-end-iso="2025-08-22T18:00:00Z">
            Add to Calendar
          </button>
          <button class="btn">Details</button>
        </footer>
      </article>

      <article class="vcard" data-party-id="test-2">
        <header class="vcard__head">
          <h3 class="vcard__title">Marriott Rooftop Mixer</h3>
          <div class="vcard__badges">
            <span class="badge badge-free">Free</span>
          </div>
        </header>
        
        <div class="vcard__meta">
          <span class="meta"><i class="i-clock"></i>20:00 – 23:30</span>
          <button class="link pin">
            <i class="i-pin"></i> Marriott Hotel
          </button>
        </div>
        
        <div class="vcard__body">
          <p class="vcard__desc">Network with industry professionals at this exclusive rooftop event.</p>
        </div>
        
        <footer class="vcard__foot">
          <button class="btn btn-primary" 
                  data-action="add-to-calendar">
            Add to Calendar
          </button>
          <button class="btn">Details</button>
        </footer>
      </article>
    </div>

    <h2>Debug Log</h2>
    <pre id="log" style="background: var(--bg-secondary); padding: var(--s-3); border-radius: var(--r-2); overflow-x: auto;"></pre>
  </div>

  <script type="module">
    import { status } from '/js/services/gcal.js';
    import { wireAddToCalendar } from '/js/gcal-hooks.js';
    
    const log = document.getElementById('log');
    const statusEl = document.getElementById('status');
    
    function addLog(msg) {
      const time = new Date().toLocaleTimeString();
      log.textContent += `[${time}] ${msg}\n`;
    }
    
    // Check initial status
    async function checkStatus() {
      try {
        addLog('Checking Google Calendar status...');
        const gcalStatus = await status();
        addLog(`Status response: ${JSON.stringify(gcalStatus)}`);
        
        if (gcalStatus.connected) {
          statusEl.innerHTML = '<p style="color: var(--color-success)">✅ Connected to Google Calendar</p>';
        } else {
          statusEl.innerHTML = '<p style="color: var(--color-warning)">⚠️ Not connected to Google Calendar - Click "Add to Calendar" to connect</p>';
        }
      } catch (err) {
        addLog(`Status check error: ${err.message}`);
        statusEl.innerHTML = '<p style="color: var(--color-error)">❌ Error checking status</p>';
      }
    }
    
    // Initialize
    checkStatus();
    wireAddToCalendar();
    addLog('Calendar integration initialized');
    
    // Listen for click events
    document.addEventListener('click', (e) => {
      if (e.target.closest('[data-action="add-to-calendar"]')) {
        addLog('Add to Calendar button clicked');
      }
    });
    
    // Re-check status periodically
    setInterval(checkStatus, 30000);
  </script>
</body>
</html>