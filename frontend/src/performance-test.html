<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Scrolling Performance Test - Gamescom 2025</title>
    <link rel="stylesheet" href="/css/main.css">
    <style>
        body { 
            padding: 20px; 
            font-family: var(--slack-font);
            background: var(--slack-color-background);
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .performance-metrics {
            background: var(--slack-color-hover);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .metric {
            text-align: center;
        }
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--slack-color-primary);
        }
        .metric-label {
            font-size: 14px;
            color: var(--slack-color-text-secondary);
            margin-top: 4px;
        }
        .test-controls {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        #performanceTest {
            height: 70vh;
            border: 2px solid var(--slack-color-border);
            border-radius: 8px;
            position: relative;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .btn-primary {
            background: var(--slack-color-primary);
            color: white;
        }
        .btn-secondary {
            background: var(--slack-color-hover);
            color: var(--slack-color-text);
            border: 1px solid var(--slack-color-border);
        }
        .btn:hover {
            transform: translateY(-1px);
        }
        .performance-log {
            background: #1a1a1a;
            color: #00ff00;
            padding: 16px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üéÆ Virtual Scrolling Performance Test</h1>
        <p>Testing the performance improvement with large event lists (up to 1000+ events)</p>
        
        <div class="performance-metrics">
            <div class="metric">
                <div class="metric-value" id="eventCount">58</div>
                <div class="metric-label">Total Events</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="renderTime">0ms</div>
                <div class="metric-label">Render Time</div>
            </div>
            <div class="metric">
                <div class="metric-value js-memoryUsage">0MB</div>
                <div class="metric-label">Memory Usage</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="visibleItems">0</div>
                <div class="metric-label">Visible Items</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="fps">60fps</div>
                <div class="metric-label">Scroll FPS</div>
            </div>
        </div>
        
        <div class="test-controls">
            <button class="btn btn-primary" onclick="loadRealEvents()">Load Real Events (58)</button>
            <button class="btn btn-secondary" onclick="generateTestEvents(100)">Generate 100 Events</button>
            <button class="btn btn-secondary" onclick="generateTestEvents(500)">Generate 500 Events</button>
            <button class="btn btn-secondary" onclick="generateTestEvents(1000)">Generate 1000 Events</button>
            <button class="btn btn-secondary" onclick="toggleView()">Toggle Grid/List</button>
            <button class="btn btn-secondary" onclick="measureScrollPerformance()">Measure Scroll FPS</button>
        </div>
        
        <div id="performanceTest" class="events-grid"></div>
        
        <div class="performance-log" id="performanceLog">
            <div>üéÆ Gamescom 2025 Virtual Scrolling Performance Test Initialized</div>
            <div>‚úÖ VirtualEventRenderer ready for testing</div>
            <div>üìä Performance metrics will appear here...</div>
        </div>
    </div>
    
    <script>
        // Performance Testing Suite
        class PerformanceTest {
            constructor() {
                this.virtualRenderer = null;
                this.events = [];
                this.isGrid = true;
                this.performanceLog = document.getElementById('performanceLog');
                this.init();
            }
            
            init() {
                const container = document.getElementById('performanceTest');
                this.virtualRenderer = new VirtualEventRenderer(container, 280);
                this.log('‚úÖ VirtualEventRenderer initialized');
                
                // Start memory monitoring
                this.startMemoryMonitoring();
            }
            
            log(message) {
                const timestamp = new Date().toLocaleTimeString();
                this.performanceLog.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                this.performanceLog.scrollTop = this.performanceLog.scrollHeight;
            }
            
            generateTestEvents(count) {
                this.log(`üèóÔ∏è Generating ${count} test events...`);
                const startTime = performance.now();
                
                this.events = [];
                const venues = ['Koelnmesse Hall 1', 'Hyatt Regency', 'Hilton Cologne', 'Maritim Hotel', 'Gaming Lounge', 'Tech Center'];
                const categories = ['networking', 'afterparty', 'mixer', 'launch'];
                const names = ['Epic Gaming Night', 'Indie Developer Meetup', 'VR Experience', 'Esports Tournament', 'Game Launch Party', 'Developer Showcase'];
                
                for (let i = 0; i < count; i++) {
                    this.events.push({
                        id: `test-event-${i}`,
                        name: `${names[i % names.length]} #${i + 1}`,
                        creator: `Developer ${i + 1}`,
                        date: '2025-08-21',
                        startTime: `${18 + (i % 6)}:00`,
                        venue: venues[i % venues.length],
                        category: categories[i % categories.length],
                        description: `This is test event ${i + 1} for performance testing. It includes all the standard fields and content that real events would have.`,
                        source: i % 3 === 0 ? 'ugc' : 'official'
                    });
                }
                
                const generateTime = performance.now() - startTime;
                this.log(`‚úÖ Generated ${count} events in ${generateTime.toFixed(2)}ms`);
                
                this.renderWithMetrics();
            }
            
            async loadRealEvents() {
                this.log('üì• Loading real events from API...');
                const startTime = performance.now();
                
                try {
                    const response = await fetch('https://us-central1-conference-party-app.cloudfunctions.net/api/parties');
                    const data = await response.json();
                    
                    this.events = data.data || data || [];
                    const loadTime = performance.now() - startTime;
                    
                    this.log(`‚úÖ Loaded ${this.events.length} real events in ${loadTime.toFixed(2)}ms`);
                    this.renderWithMetrics();
                } catch (error) {
                    this.log(`‚ùå Failed to load real events: ${error.message}`);
                }
            }
            
            renderWithMetrics() {
                const startTime = performance.now();
                
                // Clear previous render
                performance.mark('render-start');
                
                this.virtualRenderer.render(this.events, this.isGrid);
                
                performance.mark('render-end');
                performance.measure('render-duration', 'render-start', 'render-end');
                
                const renderTime = performance.now() - startTime;
                
                // Update metrics
                document.getElementById('eventCount').textContent = this.events.length;
                document.getElementById('renderTime').textContent = `${renderTime.toFixed(1)}ms`;
                document.getElementById('visibleItems').textContent = 
                    `${this.virtualRenderer.visibleEnd - this.virtualRenderer.visibleStart}`;
                
                this.log(`üöÄ Rendered ${this.events.length} events in ${renderTime.toFixed(2)}ms`);
                this.log(`üëÅÔ∏è Showing ${this.virtualRenderer.visibleEnd - this.virtualRenderer.visibleStart} visible items`);
                
                // Performance comparison
                if (this.events.length > 50) {
                    const estimatedOldMethod = this.events.length * 2; // Rough estimate
                    const improvement = ((estimatedOldMethod - renderTime) / estimatedOldMethod * 100);
                    this.log(`üìà Virtual scrolling: ~${improvement.toFixed(0)}% faster than traditional rendering`);
                }
            }
            
            toggleView() {
                this.isGrid = !this.isGrid;
                const viewType = this.isGrid ? 'Grid' : 'List';
                this.log(`üîÑ Switched to ${viewType} view`);
                this.renderWithMetrics();
            }
            
            measureScrollPerformance() {
                this.log('üìä Measuring scroll performance...');
                let frameCount = 0;
                let lastTime = performance.now();
                let totalTime = 0;
                
                const measureFrame = (currentTime) => {
                    frameCount++;
                    totalTime = currentTime - lastTime;
                    
                    if (totalTime >= 1000) { // Measure for 1 second
                        const fps = Math.round((frameCount * 1000) / totalTime);
                        document.getElementById('fps').textContent = `${fps}fps`;
                        this.log(`üéØ Measured scroll performance: ${fps} FPS`);
                        
                        if (fps >= 55) {
                            this.log('‚úÖ Excellent performance! Smooth 60fps scrolling');
                        } else if (fps >= 30) {
                            this.log('‚ö†Ô∏è Good performance, some frame drops detected');
                        } else {
                            this.log('‚ùå Performance issues detected, optimization needed');
                        }
                        return;
                    }
                    
                    requestAnimationFrame(measureFrame);
                };
                
                // Auto-scroll to trigger measurement
                const container = document.getElementById('performanceTest');
                let scrollPos = 0;
                const scrollInterval = setInterval(() => {
                    scrollPos += 50;
                    container.scrollTop = scrollPos;
                    
                    if (scrollPos > container.scrollHeight - container.clientHeight) {
                        clearInterval(scrollInterval);
                    }
                }, 16); // ~60fps scroll
                
                requestAnimationFrame(measureFrame);
            }
            
            startMemoryMonitoring() {
                setInterval(() => {
                    if (performance.memory) {
                        const usedMB = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                        document.getElementById('memoryUsage').textContent = `${usedMB}MB`;
                    }
                }, 1000);
            }
        }
        
        // Initialize performance test when page loads
        let perfTest;
        document.addEventListener('DOMContentLoaded', () => {
            perfTest = new PerformanceTest();
        });
        
        // Global functions for buttons
        function loadRealEvents() { perfTest.loadRealEvents(); }
        function generateTestEvents(count) { perfTest.generateTestEvents(count); }
        function toggleView() { perfTest.toggleView(); }
        function measureScrollPerformance() { perfTest.measureScrollPerformance(); }
    </script>
    
    <!-- Include the VirtualEventRenderer from our main app -->
    <script src="/js/app.js"></script>
</body>
</html>