<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtualized Events Demo - Conference Party Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f0f;
            color: #ffffff;
            line-height: 1.6;
        }

        .demo-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .demo-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .demo-title {
            color: #00ff88;
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .demo-subtitle {
            color: #ccc;
            font-size: 18px;
            margin-bottom: 20px;
        }

        .performance-stats {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-card {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #00ff88;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: #333;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #00ff88;
            color: #000;
        }

        .control-btn.active {
            background: #00ff88;
            color: #000;
        }

        .search-container {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
        }

        .search-input:focus {
            outline: none;
            border-color: #00ff88;
        }

        .events-container {
            height: 600px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            position: relative;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #00ff88;
            font-size: 18px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #333;
            border-top: 3px solid #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .demo-info {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .demo-info h3 {
            color: #00ff88;
            margin-bottom: 15px;
        }

        .demo-info ul {
            list-style: none;
            padding-left: 0;
        }

        .demo-info li {
            color: #ccc;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .demo-info li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #00ff88;
            font-weight: bold;
        }

        .fps-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid #333;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
        }

        .fps-good {
            color: #00ff88;
        }

        .fps-warning {
            color: #ffc107;
        }

        .fps-poor {
            color: #ff6b6b;
        }

        @media (max-width: 768px) {
            .demo-container {
                padding: 10px;
            }

            .demo-title {
                font-size: 24px;
            }

            .demo-subtitle {
                font-size: 16px;
            }

            .performance-stats {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
            }

            .events-container {
                height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="fps-indicator" id="fpsIndicator">
        <span id="fpsValue">60</span> FPS
    </div>

    <div class="demo-container">
        <header class="demo-header">
            <h1 class="demo-title">⚡ Virtualized Events Demo</h1>
            <p class="demo-subtitle">High-performance event rendering with 60fps scrolling</p>
        </header>

        <div class="performance-stats" id="performanceStats">
            <div class="stat-card">
                <span class="stat-value" id="totalEvents">0</span>
                <span class="stat-label">Total Events</span>
            </div>
            <div class="stat-card">
                <span class="stat-value" id="visibleEvents">0</span>
                <span class="stat-label">Visible Events</span>
            </div>
            <div class="stat-card">
                <span class="stat-value" id="renderTime">0ms</span>
                <span class="stat-label">Render Time</span>
            </div>
            <div class="stat-card">
                <span class="stat-value" id="memoryUsage">0MB</span>
                <span class="stat-label">Memory Usage</span>
            </div>
        </div>

        <div class="search-container">
            <input 
                type="search" 
                class="search-input" 
                id="searchEvents" 
                placeholder="🔍 Search events by name, location, or category..."
            >
        </div>

        <div class="controls">
            <button class="control-btn active" data-action="load-real">Load Real Events</button>
            <button class="control-btn" data-action="generate-1000">Generate 1,000 Events</button>
            <button class="control-btn" data-action="generate-10000">Generate 10,000 Events</button>
            <button class="control-btn" data-action="scroll-top">Scroll to Top</button>
            <button class="control-btn" data-action="clear">Clear All</button>
            <button class="control-btn" data-action="performance">Performance Test</button>
        </div>

        <div class="events-container" id="eventsContainer">
            <div class="loading">
                <div class="spinner"></div>
                Initializing virtualized event list...
            </div>
        </div>

        <div class="demo-info">
            <h3>🚀 Performance Features</h3>
            <ul>
                <li><strong>Virtual Scrolling:</strong> Only renders visible items for unlimited scalability</li>
                <li><strong>60fps Scrolling:</strong> Smooth performance even with 10,000+ events</li>
                <li><strong>Gesture Support:</strong> Native swipe gestures for like/pass actions</li>
                <li><strong>Smart Prefetching:</strong> Preloads data based on scroll patterns</li>
                <li><strong>Memory Optimization:</strong> Constant memory usage regardless of list size</li>
                <li><strong>Real-time Search:</strong> Instant filtering without performance impact</li>
                <li><strong>Progressive Loading:</strong> Load more events as you scroll</li>
                <li><strong>Performance Monitoring:</strong> Built-in FPS and memory tracking</li>
            </ul>
        </div>
    </div>

    <!-- Load virtualization components -->
    <script src="/js/components/VirtualizedEventList.js"></script>
    <script src="/js/event-list-integration.js"></script>

    <script>
        class VirtualizedEventsDemo {
            constructor() {
                this.virtualListManager = null;
                this.performanceMonitor = {
                    fps: 60,
                    renderTimes: [],
                    memoryUsage: 0
                };
                
                this.init();
            }

            async init() {
                console.log('🎯 Initializing Virtualized Events Demo...');
                
                // Wait for components to load
                await this.waitForComponents();
                
                // Setup performance monitoring
                this.setupPerformanceMonitoring();
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Initialize with real events
                await this.loadRealEvents();
                
                console.log('✅ Demo initialized successfully');
            }

            async waitForComponents() {
                return new Promise((resolve) => {
                    const checkComponents = () => {
                        if (typeof VirtualizedEventList !== 'undefined' && 
                            typeof eventListManager !== 'undefined' && 
                            eventListManager) {
                            this.virtualListManager = eventListManager;
                            resolve();
                        } else {
                            setTimeout(checkComponents, 100);
                        }
                    };
                    checkComponents();
                });
            }

            setupPerformanceMonitoring() {
                // FPS monitoring
                let lastTime = performance.now();
                let frameCount = 0;
                
                const measureFPS = (currentTime) => {
                    frameCount++;
                    
                    if (currentTime - lastTime >= 1000) {
                        this.performanceMonitor.fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                        this.updateFPSIndicator(this.performanceMonitor.fps);
                        
                        frameCount = 0;
                        lastTime = currentTime;
                    }
                    
                    requestAnimationFrame(measureFPS);
                };
                
                requestAnimationFrame(measureFPS);
                
                // Memory usage monitoring
                if ('memory' in performance) {
                    setInterval(() => {
                        this.performanceMonitor.memoryUsage = 
                            Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                        this.updatePerformanceStats();
                    }, 1000);
                }
                
                // Listen for virtual list events
                document.addEventListener('virtual-list-rendered', (e) => {
                    this.performanceMonitor.renderTimes.push(e.detail.renderTime);
                    if (this.performanceMonitor.renderTimes.length > 100) {
                        this.performanceMonitor.renderTimes = 
                            this.performanceMonitor.renderTimes.slice(-50);
                    }
                    this.updatePerformanceStats();
                });
            }

            setupEventListeners() {
                // Control buttons
                document.querySelectorAll('.control-btn').forEach(btn => {
                    btn.addEventListener('click', this.handleControlClick.bind(this));
                });
                
                // Search functionality
                const searchInput = document.getElementById('searchEvents');
                if (searchInput) {
                    searchInput.addEventListener('input', this.debounce((e) => {
                        if (this.virtualListManager) {
                            this.virtualListManager.handleSearch(e);
                        }
                    }, 300));
                }
                
                // Performance keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.target.tagName === 'INPUT') return;
                    
                    switch(e.key) {
                        case '1':
                            this.generateEvents(1000);
                            break;
                        case '2':
                            this.generateEvents(10000);
                            break;
                        case 'r':
                        case 'R':
                            if (e.ctrlKey || e.metaKey) {
                                e.preventDefault();
                                this.loadRealEvents();
                            }
                            break;
                        case 'Home':
                            if (this.virtualListManager) {
                                this.virtualListManager.scrollToTop();
                            }
                            break;
                        case 'p':
                        case 'P':
                            this.runPerformanceTest();
                            break;
                    }
                });
            }

            async handleControlClick(e) {
                const action = e.target.getAttribute('data-action');
                
                // Update active button
                document.querySelectorAll('.control-btn').forEach(btn => 
                    btn.classList.remove('active')
                );
                e.target.classList.add('active');
                
                switch(action) {
                    case 'load-real':
                        await this.loadRealEvents();
                        break;
                    case 'generate-1000':
                        this.generateEvents(1000);
                        break;
                    case 'generate-10000':
                        this.generateEvents(10000);
                        break;
                    case 'scroll-top':
                        if (this.virtualListManager) {
                            this.virtualListManager.scrollToTop();
                        }
                        break;
                    case 'clear':
                        this.clearEvents();
                        break;
                    case 'performance':
                        await this.runPerformanceTest();
                        break;
                }
            }

            async loadRealEvents() {
                if (!this.virtualListManager) return;
                
                console.log('📥 Loading real events from API...');
                
                try {
                    const response = await fetch('/api/parties?page=1&limit=100&includeUGC=true');
                    const data = await response.json();
                    
                    if (data.success && data.data) {
                        this.virtualListManager.events = data.data;
                        this.virtualListManager.virtualList.setItems(data.data);
                        
                        console.log(`✅ Loaded ${data.data.length} real events`);
                    } else {
                        // Fallback to generated events if API fails
                        console.warn('API failed, generating sample events...');
                        this.generateEvents(75);
                    }
                } catch (error) {
                    console.error('Error loading real events:', error);
                    this.generateEvents(75);
                }
            }

            generateEvents(count) {
                console.log(`🔧 Generating ${count} sample events...`);
                
                const categories = ['Gaming', 'Networking', 'Party', 'Conference', 'Workshop', 'Meetup'];
                const venues = [
                    'Gamescom Hall 1', 'Convention Center', 'Hotel Lobby', 'Rooftop Bar',
                    'Gaming Lounge', 'Expo Floor', 'VIP Suite', 'Networking Area',
                    'Conference Room A', 'Exhibition Hall', 'Media Center', 'Demo Stage'
                ];
                
                const companies = [
                    'Epic Games', 'Unity Technologies', 'Blizzard Entertainment', 'Ubisoft',
                    'EA Sports', 'Valve Corporation', 'Nintendo', 'Sony Interactive',
                    'Microsoft Gaming', 'Riot Games', 'Activision', 'Take-Two Interactive'
                ];
                
                const eventTypes = [
                    'Developer Meetup', 'Launch Party', 'Networking Event', 'Award Ceremony',
                    'Product Demo', 'Industry Panel', 'Gaming Tournament', 'VIP Reception',
                    'Press Conference', 'Community Gathering', 'Tech Talk', 'Showcase Event'
                ];
                
                const events = [];
                const startDate = new Date();
                
                for (let i = 0; i < count; i++) {
                    const category = categories[Math.floor(Math.random() * categories.length)];
                    const venue = venues[Math.floor(Math.random() * venues.length)];
                    const company = companies[Math.floor(Math.random() * companies.length)];
                    const eventType = eventTypes[Math.floor(Math.random() * eventTypes.length)];
                    
                    const eventDate = new Date(startDate.getTime() + (Math.random() * 7 * 24 * 60 * 60 * 1000));
                    const hour = Math.floor(Math.random() * 12) + 10; // 10 AM to 10 PM
                    const minute = Math.floor(Math.random() * 4) * 15; // 0, 15, 30, 45
                    
                    events.push({
                        id: `generated_${i}`,
                        'Event Name': `${company} ${eventType}`,
                        'Date': eventDate.toLocaleDateString(),
                        'Start Time': `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`,
                        'Address': venue,
                        'Category': category,
                        'Description': `Join us for an exciting ${eventType.toLowerCase()} hosted by ${company}. Network with industry professionals and discover the latest trends in ${category.toLowerCase()}.`,
                        'Hosts': company,
                        'isUGC': Math.random() > 0.7, // 30% chance of being UGC
                        'source': 'generated'
                    });
                }
                
                if (this.virtualListManager) {
                    this.virtualListManager.events = events;
                    this.virtualListManager.virtualList.setItems(events);
                }
                
                console.log(`✅ Generated ${count} events`);
            }

            clearEvents() {
                if (this.virtualListManager) {
                    this.virtualListManager.events = [];
                    this.virtualListManager.virtualList.setItems([]);
                }
                console.log('🗑️ All events cleared');
            }

            async runPerformanceTest() {
                console.log('🧪 Running performance test...');
                
                const testSizes = [100, 500, 1000, 5000, 10000];
                const results = [];
                
                for (const size of testSizes) {
                    console.log(`Testing with ${size} events...`);
                    
                    const startTime = performance.now();
                    this.generateEvents(size);
                    
                    // Wait for render
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                    // Simulate scrolling
                    if (this.virtualListManager) {
                        const container = this.virtualListManager.virtualList.wrapper;
                        for (let scroll = 0; scroll < 5000; scroll += 500) {
                            container.scrollTop = scroll;
                            await new Promise(resolve => setTimeout(resolve, 10));
                        }
                    }
                    
                    const endTime = performance.now();
                    const testTime = endTime - startTime;
                    
                    results.push({
                        size,
                        time: testTime,
                        fps: this.performanceMonitor.fps
                    });
                }
                
                console.log('📊 Performance Test Results:', results);
                
                // Show results
                alert(`Performance Test Results:\n${results.map(r => 
                    `${r.size} events: ${r.time.toFixed(2)}ms, ${r.fps} fps`
                ).join('\n')}`);
            }

            updateFPSIndicator(fps) {
                const indicator = document.getElementById('fpsValue');
                if (indicator) {
                    indicator.textContent = fps;
                    
                    const parent = indicator.parentElement;
                    parent.className = 'fps-indicator ' + 
                        (fps >= 55 ? 'fps-good' : fps >= 30 ? 'fps-warning' : 'fps-poor');
                }
            }

            updatePerformanceStats() {
                const stats = {
                    totalEvents: this.virtualListManager?.events?.length || 0,
                    visibleEvents: this.virtualListManager?.virtualList?.visibleRange ? 
                        (this.virtualListManager.virtualList.visibleRange.end - 
                         this.virtualListManager.virtualList.visibleRange.start) : 0,
                    renderTime: this.performanceMonitor.renderTimes.length > 0 ? 
                        this.performanceMonitor.renderTimes.slice(-1)[0]?.toFixed(2) + 'ms' : '0ms',
                    memoryUsage: this.performanceMonitor.memoryUsage + 'MB'
                };
                
                Object.entries(stats).forEach(([key, value]) => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.textContent = value;
                    }
                });
            }

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
        }

        // Initialize demo when page loads
        let demo;
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                demo = new VirtualizedEventsDemo();
                window.demo = demo;
            });
        } else {
            demo = new VirtualizedEventsDemo();
            window.demo = demo;
        }

        console.log('🎯 Virtualized Events Demo loaded!');
    </script>
</body>
</html>