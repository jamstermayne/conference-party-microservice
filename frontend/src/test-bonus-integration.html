<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Test Bonus Integration</title>
  <link rel="stylesheet" href="assets/css/main.css"/>
  <link rel="stylesheet" href="assets/css/animations.css"/>
  <style>
    body { padding: 20px; }
    .test-section { margin: 20px 0; padding: 20px; background: var(--surface); border-radius: 8px; }
    .test-button { margin: 10px; }
    input[type="email"] { padding: 10px; margin: 10px; border-radius: 4px; border: 1px solid var(--border); }
  </style>
</head>
<body>
  <div class="test-section">
    <h2>Test Proactive Email Sync Prompts</h2>
    
    <div>
      <h3>Test 1: Type in email field (reactive trigger)</h3>
      <input type="email" placeholder="Type your email here..." />
      <p>Type in the email field above to trigger the reactive email sync prompt.</p>
    </div>
    
    <div>
      <h3>Test 2: Simulate bonus unlock (proactive trigger)</h3>
      <button class="btn btn-primary test-button" onclick="simulateBonusUnlock()">
        Simulate +5 Bonus Invites
      </button>
      <p>Click the button above to simulate bonus invite unlock and trigger proactive sync prompt.</p>
    </div>
    
    <div>
      <h3>Test 3: Reset session</h3>
      <button class="btn btn-secondary test-button" onclick="resetSession()">
        Reset Session
      </button>
      <p>Reset the session flag to test prompts again.</p>
    </div>
    
    <div>
      <h3>Test 4: Check current state</h3>
      <button class="btn btn-secondary test-button" onclick="checkState()">
        Check State
      </button>
      <pre id="state-output"></pre>
    </div>
  </div>

  <script type="module">
    import { Store, Events } from './assets/js/state.js';
    import './assets/js/globalEmailSync.js';
    
    // Test functions
    window.simulateBonusUnlock = function() {
      console.log('ðŸ§ª Simulating bonus unlock...');
      Events.emit('invites:bonus', { added: 5, remaining: 15 });
    };
    
    window.resetSession = function() {
      sessionStorage.removeItem('emailSyncPromptShown');
      location.reload();
    };
    
    window.checkState = function() {
      const state = {
        sessionFlag: sessionStorage.getItem('emailSyncPromptShown'),
        contactsConnected: Store.get('profile.contactsConnected'),
        invites: Store.get('invites'),
        popup: document.querySelector('.email-sync-popup')
      };
      document.getElementById('state-output').textContent = JSON.stringify(state, null, 2);
    };
    
    // Listen for events to log them
    Events.on('invites:bonus', (data) => {
      console.log('ðŸ“Š invites:bonus event:', data);
    });
    
    Events.on('addressBook:syncRequest', (data) => {
      console.log('ðŸ“§ addressBook:syncRequest event:', data);
    });
    
    Events.on('analytics:track', (data) => {
      console.log('ðŸ“ˆ analytics:track event:', data);
    });
    
    console.log('ðŸ§ª Test page loaded - check console for event logs');
  </script>
</body>
</html>