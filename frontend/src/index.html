<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="maps-key" content="__ENV_GOOGLE_MAPS_KEY__" />
  <meta name="google-client-id" content="__ENV_GOOGLE_CLIENT_ID__" />
  <title>Gamescom 2025 - Professional Networking</title>
  
  <!-- PWA Resource Hints for Party List Performance -->
  <link rel="preconnect" href="https://us-central1-conference-party-app.cloudfunctions.net" crossorigin>
  <link rel="preconnect" href="https://apis.google.com" crossorigin>
  <link rel="dns-prefetch" href="//conference-party-app.web.app">
  
  <!-- Stylesheets will be loaded dynamically as needed -->
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  <!-- Design System Foundation -->
  <link rel="stylesheet" href="/assets/css/tokens.css">
  <!-- Unified Design System - Enforces Consistency -->
  <link rel="stylesheet" href="/assets/css/design-system-unified.css">
  <!-- Unified Conference App - Signature Design System -->
  <link rel="stylesheet" href="/assets/css/app-unified.css">
  <!-- Premium Party List Styles -->
  <link rel="stylesheet" href="/assets/css/party-list-premium.css">
  <!-- Settings Modal Styles -->
  <link rel="stylesheet" href="/assets/css/settings-modal.css">
</head>
<body>
  <main id="app" class="app">
    <div class="panel-stack">
      <section id="home" class="panel-base">
        <div class="home-panel" id="home-panel">
          <!-- JS populates Parties & Map sections + Channels -->
        </div>
      </section>
      <!-- Overlay panels injected dynamically -->
    </div>
  </main>
  <!-- Security Module - Load First -->
  <script type="module" src="/assets/js/security/sanitizer.js"></script>
  <!-- Feature Flags - Control blast radius -->
  <script src="/assets/js/feature-flags.js"></script>
  <!-- Component Sandbox - Isolate components -->
  <script type="module" src="/assets/js/component-sandbox.js"></script>
  
  <!-- Modern Architecture Integration (Progressive Enhancement) -->
  <script type="module">
    // Only load modern features for capable browsers
    if ('noModule' in HTMLScriptElement.prototype && window.FeatureFlags) {
      // Check if modern architecture is enabled
      if (window.FeatureFlags.isEnabled('modern_architecture')) {
        import('/modern/core/module-loader.js').then(() => {
          console.log('[Modern] Architecture loaded');
        });
        import('/modern/core/compatibility-bridge.js').then(() => {
          console.log('[Modern] Compatibility bridge established');
        });
      }
      
      // Load magic auth system if enabled
      if (window.FeatureFlags.isEnabled('magic_auth')) {
        // Load all magic auth modules
        Promise.all([
          import('/modern/auth/magic-auth.js'),
          import('/modern/components/magic-auth-ui.js'),
          import('/modern/services/company-intelligence.js'),
          import('/modern/services/profile-enrichment.js'),
          import('/modern/auth/auth-integration.js')
        ]).then(([magicAuthModule]) => {
          window.MagicAuth = new magicAuthModule.MagicAuthSystem();
          console.log('[MagicAuth] Full system initialized with enrichment');
        }).catch(err => {
          console.error('[MagicAuth] Failed to load:', err);
        });
      }
    }
  </script>
  
  <!-- PWA Install Prompt -->
  <script type="module" src="/assets/js/pwa-install-prompt.js"></script>
  <!-- Core API Module -->
  <script type="module" defer src="/assets/js/api-lite.js"></script>
  <!-- Router for preflight -->
  <script type="module" src="/assets/js/router-2panel-lite.js?v=2025"></script>
  <!-- Unified Conference App - Production Ready -->
  <script type="module" defer src="/assets/js/app-unified.js"></script>
</body>
</html>