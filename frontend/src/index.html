<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PWA Meta -->
  <meta name="theme-color" content="#6b7bff" />
  <meta name="mobile-web-app-capable" content="yes" />
  <link rel="manifest" href="/manifest.json?v=7" />

  <!-- Content Security Policy (allows Cloud Functions + Google/LinkedIn SDKs) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' https://accounts.google.com https://*.googleapis.com https://*.gstatic.com https://platform.linkedin.com; connect-src 'self' https://us-central1-conference-party-app.cloudfunctions.net https://*.googleapis.com https://*.gstatic.com https://api.linkedin.com; img-src 'self' data: https://*.gstatic.com https://*.googleusercontent.com https://media.licdn.com; style-src 'self' 'unsafe-inline'; font-src 'self' data:; frame-src https://accounts.google.com https://www.linkedin.com; worker-src 'self'; base-uri 'self'; form-action 'self' https://www.linkedin.com;" />


  <title>Velocity â€” Gamescom 2025</title>
  <meta name="application-name" content="Velocity â€” Gamescom 2025">
  <meta name="description" content="Velocity â€” your private conference social network.">

  <!-- Additional PWA -->
  <link rel="apple-touch-icon" href="/assets/icons/icon-192.png">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Social: Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Velocity â€” Gamescom 2025">
  <meta property="og:description" content="Join private conference parties and sync your calendar.">
  <meta property="og:image" content="/social/share-default.png">
  <meta property="og:url" content="https://conference-party-app.web.app">

  <!-- Social: Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Velocity â€” Gamescom 2025">
  <meta name="twitter:description" content="Join private conference parties and sync your calendar.">
  <meta name="twitter:image" content="/social/share-default.png">

  <!-- SEO -->
  <link rel="canonical" href="https://conference-party-app.web.app">
  
  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Event",
    "name": "Tech Leaders Networking Party",
    "startDate": "2025-08-19T19:00:00+01:00",
    "endDate": "2025-08-19T23:00:00+01:00",
    "eventAttendanceMode": "https://schema.org/OfflineEventAttendanceMode",
    "eventStatus": "https://schema.org/EventScheduled",
    "location": {
      "@type": "Place",
      "name": "Rooftop Bar",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "123 Conference Ave",
        "addressLocality": "Cologne",
        "addressCountry": "DE"
      }
    },
    "image": [
      "https://conference-party-app.web.app/social/event-tech-leaders.png"
    ],
    "description": "Join industry leaders for an exclusive networking party during Gamescom.",
    "organizer": {
      "@type": "Organization",
      "name": "Velocity",
      "url": "https://conference-party-app.web.app"
    }
  }
  </script>
  
  <!-- Metrics boot -->
  <script>
    // Safe Metrics boot
    try { window.Metrics?.track?.('app_boot', { inline: true }); } catch(e) {}
  </script>
  
  <link rel="stylesheet" href="assets/css/styles.css"/>
  <link rel="stylesheet" href="/assets/css/nav.css">
  <link rel="stylesheet" href="/assets/css/hotspots.css">
  <link rel="stylesheet" href="/css/panels.css?v=7">
  <link rel="stylesheet" href="/css/layout-polish.css?v=7">
  <link rel="stylesheet" href="/css/cards-parties.css?v=7">
</head>
<body>
  <!-- Skip link for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <div id="app" class="app">
    <!-- Slack-style Sidebar -->
    <aside id="sidenav" class="sidenav" aria-label="Main navigation">
      <div class="side-head">
        <div class="brand">Velocity</div>
        <div class="workspace">Gamescom 2025</div>
      </div>

      <nav class="side-nav" id="side-nav">
        <button class="nav-item" data-route="parties">
          <span class="hash" aria-hidden="true">#</span><span class="label">Parties</span>
        </button>
        <button class="nav-item" data-route="hotspots">
          <span class="hash" aria-hidden="true">#</span><span class="label">Hotspots</span>
        </button>
        <button class="nav-item" data-route="map">
          <span class="hash" aria-hidden="true">#</span><span class="label">Map</span>
        </button>
        <button class="nav-item" data-route="calendar">
          <span class="hash" aria-hidden="true">#</span><span class="label">Calendar</span>
        </button>
        <button class="nav-item" data-route="invites">
          <span class="hash" aria-hidden="true">#</span><span class="label">Invites</span>
        </button>
        <button class="nav-item" data-route="me">
          <span class="hash" aria-hidden="true">#</span><span class="label">Me</span>
        </button>
        <button class="nav-item" data-route="settings">
          <span class="hash" aria-hidden="true">#</span><span class="label">Settings</span>
        </button>
      </nav>
      <div class="side-footer">
        <div class="auth-section" id="auth-section">
          <!-- Authentication buttons (shown when not logged in) -->
          <div class="auth-buttons" id="auth-buttons">
            <button id="btn-google" class="btn btn-small auth-btn">
              ðŸ“§ Sign in with Google
            </button>
            <button id="btn-linkedin" class="btn btn-small auth-btn">
              ðŸ’¼ Sign in with LinkedIn
            </button>
          </div>
          <!-- User profile (shown when logged in) -->
          <div class="user-profile hidden" id="user-profile">
            <div class="user-info">
              <img id="user-avatar" class="user-avatar" alt="User avatar" />
              <div class="user-details">
                <div id="user-name" class="user-name"></div>
                <small id="user-email" class="user-email muted"></small>
              </div>
            </div>
            <button id="btn-signout" class="btn btn-small btn-ghost">Sign Out</button>
          </div>
        </div>
        <!-- PWA Install Button -->
        <button id="btn-install" class="btn btn-primary" style="width:100%; margin-top: 10px; display: none;">Install App</button>
        <small class="muted">Exclusive â€¢ Privacy-first</small>
      </div>
    </aside>
    <!-- Overlay (mobile) -->
    <div id="overlay" class="overlay" hidden></div>
    <!-- Main Panel -->
    <main id="main" class="main-pane">
      <header class="topbar">
        <button id="menu" class="icon-btn" aria-label="Open menu">â˜°</button>
        <h1 id="page-title">Parties</h1>
      </header>
      <!-- Route sections -->
      <section data-route="parties">
        <h2 class="text-heading">Parties</h2>
        <!-- FTUE Pick 3 Progress -->
        <div id="ftue-wrap"></div>
        <!-- Parties list target (polish enhancer writes cards here). -->
        <div data-parties-list></div>
        <div id="parties-root"></div>
        <!-- Legacy event list mount point -->
        <div id="event-list" role="region" aria-label="Gaming industry parties"></div>
      </section>
      
      <section data-route="hotspots" hidden>
        <h2 class="text-heading">Hotspots</h2>
        <div id="hotspots-root">
          <div class="hotspots-wrap">
            <article class="hotspots-canvas-card card-elevated">
              <header>
                <h3>Hotspots â€” Live Heat</h3>
                <div id="hotspots-legend" class="flex-1"></div>
              </header>
              <canvas id="hotspots-canvas" aria-label="Heatmap of active venues"></canvas>
            </article>
            <aside class="hotspots-list">
              <header>
                <h3>Venues</h3>
                <div class="hotspots-meta">
                  <span id="hotspots-last-updated"></span>
                  <button class="btn btn-ghost btn-small" data-action="hotspots-refresh">Refresh</button>
                </div>
              </header>
              <div id="hotspots-list" class="hotspots-scroll"></div>
            </aside>
          </div>
        </div>
      </section>
      
      <section data-route="map" hidden>
        <h2 class="text-heading">Map</h2>
        <div id="map-root">
          <div class="hotspots-wrap">
            <div id="map-canvas"></div>
            <aside class="hotspots-list">
              <header>
                <h3>Venues</h3>
              </header>
              <div id="map-venues" class="hotspots-scroll"></div>
            </aside>
          </div>
        </div>
      </section>
      
      <section data-route="calendar" hidden>
        <h2 class="text-heading">Calendar</h2>
        <div class="stack-2">
          <div class="flex gap-8" style="padding: 0 16px;">
            <button class="btn btn-secondary" data-action="calendar-link" data-type="apple">Add to Apple Calendar</button>
            <button class="btn btn-secondary" data-action="calendar-link" data-type="outlook">Add to Outlook</button>
          </div>
          <div id="calendar-days" class="flex gap-6" style="padding: 0 16px;">
            <button class="btn btn-ghost" data-day="thu">Thu</button>
            <button class="btn btn-ghost" data-day="fri">Fri</button>
            <button class="btn btn-ghost" data-day="sat">Sat</button>
            <button class="btn btn-ghost" data-day="sun">Sun</button>
          </div>
          <div id="calendar-list" style="padding: 0 16px;"></div>
        </div>
      </section>
      
      <section data-route="invites" hidden>
        <h2 class="text-heading">Invites</h2>
        <div id="invites-root"></div>
      </section>
      
      <section data-route="opportunities" hidden>
        <h2 class="text-heading">Opportunities</h2>
        <div id="opps-root"></div>
      </section>
      
      <section data-route="me" hidden>
        <h2 class="text-heading">Your Profile</h2>
        <div id="me-root"></div>
      </section>
      
      <section data-route="settings" hidden>
        <h2 class="text-heading">Settings</h2>
        <div id="settings-root"></div>
      </section>
      <!-- Enhanced Install Card with Accessibility -->
      <div id="install-card" class="install-card hidden" role="dialog" aria-labelledby="install-title" aria-describedby="install-desc">
        <div class="install-content" tabindex="-1">
          <img src="/assets/icons/icon-192.png" alt="Velocity App Icon" class="install-icon" />
          <h3 id="install-title">Install Velocity</h3>
          <p id="install-desc">Add Velocity for instant access to parties & invites.</p>
          <div class="row gap">
            <button id="install-btn" class="btn btn-primary" aria-label="Install Velocity App">Install</button>
            <button id="install-dismiss" class="btn btn-secondary" aria-label="Dismiss install prompt">Not Now</button>
          </div>
        </div>
      </div>
      <!-- iOS Install Hint -->
      <div id="install-ios-hint" class="install-ios-hint">Share â†’ Add to Home Screen</div>
      <!-- Toasts -->
      <template id="tpl-toast"><div class="toast"><span class="msg"></span></div></template>
      <!-- SR-only Live -->
      <div id="aria-live-status" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    </main>
  </div>
  <!-- ENV must come first -->
  <script src="/js/env.js?v=6"></script>

  <!-- Foundation (module) -->
  <script type="module" src="/assets/js/foundation/app-bootstrap.js?v=6"></script>
  <script type="module" src="/assets/js/foundation/sw-register.js?v=6"></script>

  <!-- Metrics: shim ONLY (no ESM metrics module right now) -->
  <script nomodule src="/js/metrics-shim.js?v=6"></script>

  <!-- Core modules -->
  <script type="module" src="/js/store.js?v=6"></script>
  <script type="module" src="/js/events.js?v=6"></script>
  <script type="module" src="/js/ui-feedback.js?v=6"></script>
  <script type="module" src="/js/install.js?v=6"></script>
  <script type="module" src="/js/auth.js?v=6"></script>
  <script type="module" src="/js/router.js?v=7"></script>

  <!-- Feature controllers -->
  <script type="module" src="/js/invite.js?v=6"></script>
  <script type="module" src="/js/invite-panel.js?v=6"></script>
  <script type="module" src="/js/invite-badge-sync.js?v=6"></script>
  <script type="module" src="/js/calendar-integration.js?v=6"></script>
  <script type="module" src="/js/events-controller.js?v=6"></script>

  <!-- Keep optional modules MODULED (prevents "import outside module") -->
  <script type="module" src="/js/ftue-progress.js?v=6"></script>
  <script type="module" src="/js/router-route-metrics.js?v=6"></script>

  <!-- TEMP: comment out if your file isn't ready; or keep with fixed file below -->
  <script type="module" src="/js/activity-feed.js?v=6"></script>

  <!-- Panel enhancements -->
  <script type="module" src="/js/hotspots.js?v=7"></script>
  <script type="module" src="/js/map.js?v=7"></script>
  <script type="module" src="/js/parties-polish.js?v=7"></script>

  <!-- Layout polish -->
  <script type="module" src="/js/route-title.js?v=7"></script>
  <script type="module" src="/js/layout-snap.js?v=7"></script>

  <!-- Final wire-up -->
  <script type="module" src="/js/app-wireup.js?v=7"></script>
  
  <!-- PWA Install Handler -->
  <script type="module">
    // Handle PWA install prompt
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
      // Prevent the mini-infobar from appearing on mobile
      e.preventDefault();
      // Stash the event so it can be triggered later
      deferredPrompt = e;
      // Update UI to show install button
      const installBtn = document.getElementById('btn-install');
      if (installBtn) {
        installBtn.style.display = 'block';
      }
    });
    
    // Handle install button click
    document.getElementById('btn-install')?.addEventListener('click', async () => {
      if (deferredPrompt) {
        // Show the install prompt
        deferredPrompt.prompt();
        // Wait for the user to respond to the prompt
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`User response to the install prompt: ${outcome}`);
        // Clear the deferred prompt
        deferredPrompt = null;
        // Hide the install button
        document.getElementById('btn-install').style.display = 'none';
      }
    });
    
    // Check if already installed
    window.addEventListener('appinstalled', () => {
      console.log('PWA was installed');
      const btnInstall = document.getElementById('btn-install');
      if (btnInstall) btnInstall.style.display = 'none';
    });
  </script>
  
  <!-- Safe bootstrap (ensures clean route initialization) -->
  <script type="module">
    import Router from '/js/router.js';
    // Ensure default route
    if (!location.hash) location.hash = '#/parties';
    // Light route metric hook (won't throw if not wired)
    window.addEventListener('hashchange', () => {
      try { window.Metrics?.trackRoute?.(location.hash || '#/parties'); } catch {}
    });
  </script>


</body>
</html>